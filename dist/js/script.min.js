function distance(a,b,c,d){var e=Math.PI*a/180,f=Math.PI*c/180,g=(Math.PI*b/180,Math.PI*d/180,b-d),h=Math.PI*g/180,i=Math.sin(e)*Math.sin(f)+Math.cos(e)*Math.cos(f)*Math.cos(h);return i=Math.acos(i),i=180*i/Math.PI,i=60*i*1.1515}function outputUpdate(a){document.querySelector("#range").value=a}$.getJSON("http://api.songkick.com/api/3.0/events.json?apikey=afM2GDbBHSRIRxf6&location=clientip&jsoncallback=?",function(a){var b=a;createGig(b)});var createGig=function(a){gigs=[];for(var b=0;a.resultsPage.results.event.length>b;b++){name=a.resultsPage.results.event[b].displayName;var c=name.indexOf("(");name=name.substring(0,-1!=c?c:name.length),link=a.resultsPage.results.event[b].uri,lat=a.resultsPage.results.event[b].venue.lat,lng=a.resultsPage.results.event[b].venue.lng,status=a.resultsPage.results.event[b].status,"ok"==status&&gigs.push({name:name,link:link,lat:lat,lng:lng,distance:0})}getDistance()},getDistance=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){console.log("GeoLocation"),userLat=a.coords.latitude,userLong=a.coords.longitude;for(var b=0;gigs.length>b;b++){var c=gigs[b].lat,d=gigs[b].lng;gigs[b].distance=distance(c,d,userLat,userLong)}$(".spinner").fadeOut(1e3),setTimeout(function(){$(".start").fadeIn(1e3)},1e3)},function(a){a.code==a.PERMISSION_DENIED&&console.log("No Geo"),$(".spinner").fadeOut(1e3),setTimeout(function(){$(".start").fadeIn(1e3)},1e3)})},start=function(){$(".start").fadeOut(1e3),setTimeout(function(){$(".shuffle").addClass("active"),userMaxDistance=document.querySelector("#max-distance").value,closeGigs=[];for(var a=0;gigs.length>a;a++)gigs[a].distance<userMaxDistance&&closeGigs.push("<div><a href='"+gigs[a].link+"' target='_blank'>"+gigs[a].name+"</a></div>");newGig(),console.log(closeGigs)},1100)};$(".shuffle").on("click",function(){newGig()});var newGig=function(){var a=closeGigs[Math.floor(Math.random()*closeGigs.length)];closeGigs.splice($.inArray(a,closeGigs),1),a?($("#here").html(a),newBg()):($("#here").html("No Gigs! Widen your search!"),$("body").css("background-color","#37457e"),setTimeout(function(){$("#here").html(""),setTimeout(function(){$(".shuffle").removeClass("active"),$(".start").fadeIn()},100)},1500))},bgs=["#18807a","#4fba8a","#ffce6d","#ff7858","#f84045","#37457e"],newBg=function(){var a=bgs[Math.floor(Math.random()*bgs.length)],b=bgs[Math.floor(Math.random()*bgs.length)];$("body").css("background-color",a),$(".shuffle").css("background-color",b)};$(document).ready(function(){$(".start").on("click",function(){start()})});